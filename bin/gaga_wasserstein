#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import click
import gaga
import phsp
from torch.autograd import Variable
import torch
import numpy as np

CONTEXT_SETTINGS = dict(help_option_names=['-h', '--help'])
@click.command(context_settings=CONTEXT_SETTINGS)
@click.argument('phsp_filename')
@click.argument('pth_filename')
@click.option('--n', '-n', default=1e4, help='Number of samples to generate')
@click.option('--l', '-l', default=1e2, help='Number of projections')
def gaga_wasserstein(phsp_filename, pth_filename, n, l):
    '''
    \b
    Compute sliced Wasserstein between real and GAN generated distributions

    \b
    <PHSP_FILENAME>   : input phase space file PHSP file (.npy)
    <PTH_FILENAME>    : input GAN PTH file (.pth)
    '''

    n = int(n)
    # load phsp
    real, r_keys, m = phsp.load(phsp_filename, n)

    # load pth
    params, G, optim, dtypef = gaga.load(pth_filename)

    # convert array of key into str
    f_keys = params['keys']
    fk = ''
    for k in f_keys:
        fk = fk+k+' '
    f_keys = fk

    # required dimension from real
    real, keys = phsp.select_keys(real, r_keys, f_keys)

    # generate samples
    fake = gaga.generate_samples_torch(params, G, dtypef, n)

    # convert real to pytorch Tensor
    real = Variable(torch.from_numpy(real)).type(dtypef)

    # distance
    d = gaga.sliced_wasserstein(real, fake, l)
    print(d)

    
    

# --------------------------------------------------------------------------
if __name__ == '__main__':
    gaga_wasserstein()

